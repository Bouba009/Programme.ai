<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aitchikh Consulting | المستشار الذكي</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #111827;
            --accent: #f59e0b; /* لون برتقالي جديد أنيق */
            --bg-body: #f3f4f6;
            --white: #ffffff;
            --radius: 12px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-body);
            color: #1f2937;
            margin: 0; padding: 0; font-size: 16px; line-height: 1.6;
        }
        header {
            background: var(--primary); color: var(--white); padding: 15px 20px;
            position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .brand { font-weight: 900; font-size: 1.2rem; }
        .brand span { color: var(--accent); }
        .hero {
            background: linear-gradient(180deg, var(--primary) 0%, #1e293b 100%);
            color: white; padding: 30px 20px 70px; text-align: center;
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; margin-bottom: -50px;
        }
        .container { padding: 0 15px 40px; max-width: 800px; margin: 0 auto; }
        .card {
            background: var(--white); border-radius: var(--radius); padding: 25px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); border-top: 4px solid var(--accent); margin-bottom: 25px;
        }
        label { display: block; margin-bottom: 8px; font-weight: 700; color: #374151; font-size: 0.9rem; }
        input, select, textarea {
            width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: var(--radius);
            font-family: 'Cairo', sans-serif; font-size: 1rem; background: #f9fafb; transition: 0.3s;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--accent); outline: none; background: #fff; }
        .btn-analyze {
            background: var(--primary); color: white; border: none; width: 100%; padding: 16px;
            border-radius: var(--radius); font-size: 1.1rem; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: center; gap: 10px;
            transition: 0.2s;
        }
        .btn-analyze:active { transform: scale(0.98); background: var(--accent); }
        .btn-analyze:disabled { background: #9ca3af; }
        
        #resultsArea { display: none; animation: slideUp 0.6s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .section-title {
            display: flex; align-items: center; gap: 10px; background: #f8fafc; padding: 12px;
            border-radius: 8px; border-right: 4px solid var(--accent); margin-bottom: 15px;
        }
        .section-title h3 { margin: 0; font-size: 1.1rem; color: var(--primary); }
        .section-title i { color: var(--accent); font-size: 1.2rem; }
        .report-card { background: white; padding: 20px; border-radius: var(--radius); margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .table-wrap { overflow-x: auto; margin-top: 10px; border: 1px solid #e5e7eb; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; font-size: 0.9rem; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid #e5e7eb; }
        th { background: #f3f4f6; font-weight: 700; white-space: nowrap; color: var(--primary); }
        tr:last-child td { border-bottom: none; }
        
        .loader-screen { display: none; text-align: center; padding: 40px 0; }
        .spinner { width: 50px; height: 50px; border: 5px solid #e5e7eb; border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        .alert-offline {
            background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; font-size: 0.9rem; margin-bottom: 20px; border: 1px solid #ffeeba; display: none; text-align: center;
        }
        footer { text-align: center; padding: 20px; color: #6b7280; font-size: 0.85rem; margin-top: 30px; }
    </style>
</head>
<body>

<header>
    <div class="brand">Aitchikh<span>Consulting</span></div>
</header>

<div class="hero">
    <h1>مستشار المشاريع الذكي</h1>
    <p>تحليل سوق دقيق بالذكاء الاصطناعي (Groq Llama 3)</p>
</div>

<div class="container">
    <div class="card" id="inputForm">
        <div class="form-group">
            <label>عنوان أو فكرة المشروع</label>
            <input type="text" id="projectTitle" placeholder="مثال: تطبيق توصيل الخبز">
        </div>
        <div class="form-group">
            <label>المجال</label>
            <select id="projectField">
                <option value="تجارة إلكترونية">تجارة إلكترونية (E-commerce)</option>
                <option value="خدمات وتوصيل">خدمات وتوصيل (Delivery)</option>
                <option value="مطاعم">مطاعم ومواد غذائية</option>
                <option value="تعليم">تعليم وتدريب</option>
                <option value="حرف وصناعة">صناعة وحرف</option>
                <option value="أخرى">مجال آخر</option>
            </select>
        </div>
        <div class="form-group">
            <label>رأس المال (DZD)</label>
            <input type="number" id="projectBudget" placeholder="مثال: 1000000">
        </div>
        <div class="form-group">
            <label>التفاصيل (مهم جداً للدقة)</label>
            <textarea id="projectDetails" rows="4" placeholder="اكتب تفاصيل الفكرة، المنطقة المستهدفة (مثلاً الجزائر العاصمة)، ومن هم عملاؤك..."></textarea>
        </div>
        <button class="btn-analyze" onclick="startProcess()">
            <span>انشاء الخطة الاستراتيجية</span>
            <i class="fa-solid fa-wand-magic-sparkles"></i>
        </button>
    </div>

    <!-- Loader -->
    <div class="loader-screen" id="loader">
        <div class="spinner"></div>
        <div style="font-weight:bold; color:var(--primary);" id="loadingText">جاري الاتصال بقاعدة البيانات...</div>
        <p style="font-size:0.8rem; color:#666;">نستخدم   لتحليل السوق الجزائري</p>
    </div>

    <!-- Results -->
    <div id="resultsArea">
        <!-- تنبيه في حال انقطاع الاتصال -->
        <div id="offlineAlert" class="alert-offline">
            <i class="fa-solid fa-triangle-exclamation"></i> 
            <strong>تنبيه:</strong> السيرفر مشغول حالياً. تم إنشاء خطة تقديرية بناءً على خوارزميات المحاكاة.
        </div>

        <div class="card" style="text-align:center;">
            <h2 id="displayTitle" style="color:var(--primary); margin:0;"></h2>
            <div style="color:var(--accent); font-weight:bold; font-size:0.9rem; margin-top:5px;">خطة عمل احترافية 2025</div>
        </div>

        <div class="report-card">
            <div class="section-title"><i class="fa-solid fa-chart-pie"></i> <h3>توزيع الميزانية التقديري</h3></div>
            <div style="height:250px; position:relative;"><canvas id="budgetChart"></canvas></div>
        </div>

        <!-- المحتوى القادم من AI -->
        <div id="aiContent"></div>
    </div>
</div>

<footer><p>© 2025 Aitchikh Consulting</p></footer>

<script>
    // ==========================================
    // إعدادات المفتاح الجديد (Groq API)
    // ==========================================
    const API_KEY = "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";
    
    // استخدام موديلات Groq السريعة جداً
    const MODELS = [
        "llama-3.3-70b-versatile", // الأفضل للعربية والتحليل
        "llama-3.1-70b-versatile",
        "mixtral-8x7b-32768"
    ];

    let budgetChartInstance = null;

    async function startProcess() {
        const title = document.getElementById('projectTitle').value;
        const field = document.getElementById('projectField').value;
        const budget = document.getElementById('projectBudget').value;
        const details = document.getElementById('projectDetails').value;

        if(!title || !budget || !details) { alert("يرجى ملء جميع الحقول للحصول على نتائج دقيقة"); return; }

        // إخفاء النموذج وإظهار التحميل
        document.getElementById('inputForm').style.display = 'none';
        document.getElementById('loader').style.display = 'block';
        document.getElementById('displayTitle').innerText = title;
        document.getElementById('offlineAlert').style.display = 'none';

        // رسم المخطط البياني فوراً
        renderChart(budget);

        let aiSuccess = false;
        const prompt = createPrompt(title, field, budget, details);

        // محاولة الاتصال بالموديلات بالترتيب
        for (const model of MODELS) {
            try {
                document.getElementById('loadingText').innerText = `جاري التحليل...`;
                
                // الرابط الخاص بـ Groq
                const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": model,
                        "messages": [
                            {"role": "system", "content": "أنت خبير استشاري واقتصادي متخصص في السوق الجزائري. تعطي إجابات دقيقة، واقعية، وباللغة العربية، وتستخدم تنسيق HTML فقط."},
                            {"role": "user", "content": prompt}
                        ],
                        "temperature": 0.6, // توازن بين الإبداع والدقة
                        "max_tokens": 2048
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.choices && data.choices.length > 0) {
                        const content = data.choices[0].message.content.replace(/```html/g, '').replace(/```/g, '');
                        document.getElementById('aiContent').innerHTML = content;
                        enhanceTitles();
                        aiSuccess = true;
                        break; // نجاح
                    }
                } else {
                    console.error("Groq Error:", response.status);
                }
            } catch (e) {
                console.warn(`Model ${model} failed`, e);
            }
        }

        // إذا فشل الاتصال، استخدم المحاكاة
        if (!aiSuccess) {
            document.getElementById('offlineAlert').style.display = 'block';
            document.getElementById('aiContent').innerHTML = generateSimulation(title, field, budget);
            enhanceTitles();
        }

        // عرض النتائج النهائية
        document.getElementById('loader').style.display = 'none';
        document.getElementById('resultsArea').style.display = 'block';
    }

    function createPrompt(title, field, budget, details) {
        return `
            أنت مستشار أعمال محترف في الجزائر (سنة 2025).
            المشروع: ${title}
            المجال: ${field}
            الميزانية: ${budget} دج
            التفاصيل: ${details}
            
            المطلوب: قم بإعداد دراسة جدوى وخطة عمل بصيغة HTML (داخل div فقط) تحتوي على:
            
            1. **دراسة المنافسين في الجزائر:** (استخدم <div class="report-card">...</div>)
               - اذكر 3 منافسين حقيقيين بالاسم (مثل Yassir, Jumia, Ouedkniss, Temtem, Coursa... أو محلات معروفة حسب المجال).
               - أنشئ جدولاً يقارن نقاط القوة والضعف لكل منافس.
            
            2. **تحليل SWOT:** (استخدم <div class="report-card">...</div>)
               - جدول SWOT دقيق يراعي خصوصية السوق الجزائري (بيروقراطية، دفع نقدي، انترنت...).
            
            3. **خطة العمل والجدول الزمني:** (استخدم <div class="report-card">...</div>)
               - جدول زمني للأنشطة (التأسيس، التسويق، الإطلاق).
            
            4. **استراتيجية التسويق:** (استخدم <div class="report-card">...</div>)
               - كيف نسوق في الجزائر؟ (Facebook Ads, Instagram, Influencers).
            
            5. **التحديات والحلول:** (استخدم <div class="report-card">...</div>)
               - مشاكل واقعية (مثل مشاكل التوصيل والدفع) وحلولها.

            تنبيه: استخدم <div class="section-title"><h3>العنوان</h3></div> للعناوين، واستخدم <div class="table-wrap"><table>...</table></div> للجداول.
        `;
    }

    // دالة المحاكاة (Fallback)
    function generateSimulation(title, field, budget) {
        return `
            <div class="report-card">
                <div class="section-title"><h3>المنافسون في السوق</h3></div>
                <p>بناءً على قاعدة بياناتنا، المنافسون المحتملون في قطاع ${field}:</p>
                <div class="table-wrap">
                    <table>
                        <thead><tr><th>المنافس</th><th>النوع</th><th>نقاط القوة</th></tr></thead>
                        <tbody>
                            <tr><td>تطبيقات كبرى (Yassir/Jumia)</td><td>Tech Giant</td><td>شهرة واسعة وتمويل ضخم</td></tr>
                            <tr><td>السوق الموازي</td><td>Informal</td><td>أسعار منخفضة جداً</td></tr>
                            <tr><td>صفحات انستغرام</td><td>Social Selling</td><td>تواصل سريع مع الزبون</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="report-card">
                <div class="section-title"><h3>خطة العمل (3 أشهر)</h3></div>
                <ul style="padding-right:20px;">
                    <li><strong>الشهر 1:</strong> كراء المكان/تطوير التطبيق + استخراج السجل التجاري.</li>
                    <li><strong>الشهر 2:</strong> شراء المعدات + بداية الحملة الإعلانية (${budget*0.2} دج).</li>
                    <li><strong>الشهر 3:</strong> الافتتاح الرسمي + عروض ترويجية.</li>
                </ul>
            </div>
        `;
    }

    function renderChart(budget) {
        if(budgetChartInstance) budgetChartInstance.destroy();
        const ctx = document.getElementById('budgetChart').getContext('2d');
        const b = parseFloat(budget);
        budgetChartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['تجهيزات (40%)', 'تسويق (25%)', 'رواتب (20%)', 'مصاريف (15%)'],
                datasets: [{
                    data: [b*0.4, b*0.25, b*0.2, b*0.15],
                    backgroundColor: ['#1f2937', '#f59e0b', '#10b981', '#6b7280'],
                    borderWidth: 0
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { font: { family: 'Cairo' } } } } }
        });
    }

    function enhanceTitles() {
        // إضافة أيقونات للعناوين القادمة من الذكاء الاصطناعي
        const icons = { "المنافس": "fa-users", "SWOT": "fa-chess", "خطة": "fa-calendar-days", "التسويق": "fa-bullhorn", "تحديات": "fa-road-barrier" };
        document.querySelectorAll('h3').forEach(h3 => {
            for (const [key, icon] of Object.entries(icons)) {
                if(h3.innerText.includes(key) && !h3.innerHTML.includes('i>')) {
                    h3.innerHTML = `<i class="fa-solid ${icon}" style="color:var(--accent); margin-left:10px;"></i> ${h3.innerText}`;
                }
            }
        });
    }
</script>

</body>
</html>
